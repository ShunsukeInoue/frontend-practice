import json
import re

def parse_ranked_contexts(text: str) -> str:
    """
    入力テキストから「N位〜」で始まるブロックを抽出し、
    [{"rank": N, "content": "N位の…(/files/…)\n本文…"}, ...] のJSON文字列を返す。
    content にはファイル名の行（= N位の行）も含める。
    """
    rank_re = re.compile(r"^\s*(\d+)\s*位\b")

    results = []
    current_rank = None
    buf = []

    for raw_line in text.splitlines():
        line = raw_line.rstrip("\n")

        m = rank_re.match(line)
        if m:
            # 直前ブロックを確定
            if current_rank is not None:
                results.append({
                    "rank": current_rank,
                    "content": "\n".join(buf).strip("\n"),
                })
            # 新ブロック開始（この行=ファイル名行もcontentに含める）
            current_rank = int(m.group(1))
            buf = [line.strip()]
        else:
            # ブロック開始前の無駄テキストは無視
            if current_rank is None:
                continue
            buf.append(line)

    # 最後のブロックを確定
    if current_rank is not None:
        results.append({
            "rank": current_rank,
            "content": "\n".join(buf).strip("\n"),
        })

    return json.dumps(results, ensure_ascii=False, indent=2)

# 使い方
text = """
無駄なテキスト文
1位のコンテキストファイル名(/files/〜)
コンテキスト本文
2位のコンテキストファイル名(/files/〜)
コンテキスト本文
"""

json_text = parse_ranked_contexts(text)
print(json_text)
